#!/bin/csh
#

# time
python  /home/user/vikram/DSA_utils/get_timestr.py > /mnt/nfs/website/time.dat
set tm = `cat time.dat`
sed "s/CTIME/${tm}/" tindex.html > tt
mv tt index.html
sed "s/CTIME/${tm}/" tadc.html > tt
mv tt adc.html
sed "s/CTIME/${tm}/" trfi.html > tt
mv tt rfi.html
sed "s/CTIME/${tm}/" tcorr.html > tt
mv tt corr.html
set old_tm = ${tm}
    

while (1)

    # time
    python  /home/user/vikram/DSA_utils/get_timestr.py > /mnt/nfs/website/time.dat
    set tm = `cat time.dat`
    sed "s/${old_tm}/${tm}/" index.html > tt
    mv tt index.html
    sed "s/${old_tm}/${tm}/" adc.html > tt
    mv tt adc.html
    sed "s/${old_tm}/${tm}/" rfi.html > tt
    mv tt rfi.html
    sed "s/${old_tm}/${tm}/" corr.html > tt
    mv tt corr.html
    set old_tm = ${tm}
    

    # heimdall output
    /home/user/vikram/DSA_utils/plot_FRB_cands_once /mnt/nfs/data/heimdallheimdall.cand

    # ADC
    python /home/user/vikram/DSA_utils/adchists.py

    # RFI
    set fl = `ls -drt /mnt/nfs/data/slog*.fits | tail -n 1`
    python /home/user/vikram/DSA_utils/plot_spectrometer_log_once.py ${fl}
    
    # correlator
    # assumes processes are running on dsa1-4 to put last integration on nfs
    python /home/user/vikram/DSA_utils/monitor_corr_once.py /mnt/nfs/data/dsa1_mon.fits /mnt/nfs/website/CORR/dsa1.png
    python /home/user/vikram/DSA_utils/monitor_corr_once.py /mnt/nfs/data/dsa2_mon.fits /mnt/nfs/website/CORR/dsa2.png
    python /home/user/vikram/DSA_utils/monitor_corr_once.py /mnt/nfs/data/dsa3_mon.fits /mnt/nfs/website/CORR/dsa3.png
    python /home/user/vikram/DSA_utils/monitor_corr_once.py /mnt/nfs/data/dsa4_mon.fits /mnt/nfs/website/CORR/dsa4.png
    
    # logs
    cp /mnt/nfs/runtime/*.log LOGS
    foreach fl (`ls -d LOGS/*`)
	mv $fl ${fl}.txt
    end

    rsync 
    
    sleep 5
    
end
